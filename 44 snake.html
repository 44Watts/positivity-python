<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>44Watts Positivity Python</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
  :root{
    --navy:#0e1b3d; --navy-2:#112452;
    --tile-1:#2c79b7; --tile-2:#34b0c9; --tile-3:#6bd2ea;
    --bulb-off:#eef2f7; --bulb-off-stroke:#233044;
    --bulb-on:#ffd84d; --bulb-on-glow:rgba(255,216,77,.45);
    --snake:#58c0d6; --snake-head:#8fe3ff; --snake-extra:#24e36b; --face:#0a1a2f;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;color:#e8f4ff;text-align:center;
    font-family:'Press Start 2P',system-ui,monospace;
    background:radial-gradient(1200px 600px at 50% -10%, #142a63 0%, var(--navy) 60%, #0a1634 100%);
    overflow-x:hidden;
  }
  #bgSquares{position:fixed;inset:0;pointer-events:none;z-index:-1}

  header{padding:10px 10px}
  h1{margin:4px 0 6px;font-size:18px;letter-spacing:.5px}
  .hud{
    display:flex;gap:10px;justify-content:center;align-items:center;flex-wrap:wrap;
    font-size:12px
  }
  .chip{
    display:inline-flex;align-items:center;gap:6px;
    padding:4px 10px;border-radius:9999px;
    background:rgba(255,255,255,.08);
    line-height:1;
  }
  #soundBtn{
    font-family:'Press Start 2P',monospace;font-size:12px;
    padding:6px 10px;border:none;border-radius:9999px;cursor:pointer;
    color:var(--navy);background:#e9f7ff;box-shadow:0 3px 10px rgba(0,0,0,.25)
  }

  /* Quote card ABOVE the board, in normal flow */
  #quote{
    position:relative; z-index:1; pointer-events:none;
    margin:8px auto 10px; /* pushes board down a bit */
    padding:10px 12px; border-radius:12px; max-width:90vw; width:min(720px,90vw);
    font-size:12px; line-height:1.4;
    color:#0a1a2f; background:rgba(255,255,255,.96); box-shadow:0 8px 30px rgba(0,0,0,.35);
    opacity:0; transform:translateY(-6px); transition:opacity .35s, transform .35s;
  }
  #quote.show{opacity:1; transform:translateY(0)}

  canvas{
    display:block;margin:8px auto;border-radius:14px;box-shadow:0 14px 60px rgba(0,0,0,.35);
    background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(0,0,0,.08));
  }
  @media (min-width:900px){
    #game{width:720px!important;height:720px!important}
  }

  .controls{margin:8px 0 6px}
  .dpad{display:inline-grid;grid-template-columns:repeat(3,48px);gap:6px}
  .dpad button{
    font-family:'Press Start 2P',monospace;font-size:14px;
    padding:10px 0;border:none;border-radius:10px;cursor:pointer;
    color:var(--navy);background:#e9f7ff;box-shadow:0 6px 18px rgba(0,0,0,.25)
  }
  .dpad .blank{visibility:hidden}

  @media (max-height:750px){
    header{padding:8px 8px}
    .dpad{grid-template-columns:repeat(3,44px)}
    .dpad button{padding:8px 0}
  }
</style>
</head>
<body>
  <canvas id="bgSquares" aria-hidden="true"></canvas>

  <header>
    <h1>44Watts Positivity Snake</h1>
    <div class="hud">
      <div class="chip">Score: <span id="score">0</span></div>
      <div class="chip">High: <span id="high">0</span></div>
      <div class="chip">Mood: <span id="mood">üôÇ</span></div>
      <button id="soundBtn" title="Toggle sound">üîà Sound: Off</button>
    </div>
  </header>

  <!-- Quote card now ABOVE the board -->
  <div id="quote" role="status" aria-live="polite"></div>

  <!-- 20 √ó 20 board (600 / 30px cells) -->
  <canvas id="game" width="600" height="600" aria-label="Game canvas"></canvas>

  <div class="controls">
    <div class="dpad" aria-label="Onscreen directional pad">
      <span class="blank"></span><button id="up">‚¨ÜÔ∏è</button><span class="blank"></span>
      <button id="left">‚¨ÖÔ∏è</button><button id="down">‚¨áÔ∏è</button><button id="right">‚û°Ô∏è</button>
    </div>
  </div>

<script>
(() => {
  /* ---------- Resolve CSS vars with hard fallbacks ---------- */
  const FALL = {
    '--tile-1':'#2c79b7','--tile-2':'#34b0c9','--tile-3':'#6bd2ea',
    '--bulb-off':'#eef2f7','--bulb-off-stroke':'#233044',
    '--bulb-on':'#ffd84d','--bulb-on-glow':'rgba(255,216,77,.45)',
    '--snake':'#58c0d6','--snake-head':'#8fe3ff','--snake-extra':'#24e36b','--face':'#0a1a2f'
  };
  const CSS = getComputedStyle(document.documentElement);
  const cssVar = name => (CSS.getPropertyValue(name).trim() || FALL[name]);
  const COLORS = {
    tile1: cssVar('--tile-1'), tile2: cssVar('--tile-2'), tile3: cssVar('--tile-3'),
    bulbOff: cssVar('--bulb-off'), bulbOffStroke: cssVar('--bulb-off-stroke'),
    bulbOn: cssVar('--bulb-on'), bulbOnGlow: cssVar('--bulb-on-glow'),
    snake: cssVar('--snake'), snakeHead: cssVar('--snake-head'),
    snakeExtra: cssVar('--snake-extra'), face: cssVar('--face')
  };

  /* ---------------- Background animation (site-wide) ---------------- */
  const bg = document.getElementById('bgSquares');
  const bctx = bg.getContext('2d');
  let tiles = [];
  const tcolors = ['#15346a','#112452',COLORS.tile1,COLORS.tile2,COLORS.tile3];
  function resizeBG(){ bg.width = innerWidth; bg.height = innerHeight; initTiles(); }
  addEventListener('resize', resizeBG, {passive:true}); resizeBG();
  function initTiles(){
    tiles = [];
    const size = 18, gap = 10;
    for(let y = 0; y < bg.height; y += size+gap){
      for(let x = 0; x < bg.width; x += size+gap){
        if (Math.random() < 0.08){
          tiles.push({
            x, y, s: size,
            c: tcolors[(Math.random()*tcolors.length)|0],
            a: Math.random()*0.2 + 0.05,
            spd: 0.6 + Math.random()*0.7,
            t: Math.random()*Math.PI*2
          });
        }
      }
    }
  }
  function drawBG(ts){
    bctx.clearRect(0,0,bg.width,bg.height);
    for(const q of tiles){
      q.t += 0.0025*q.spd*ts;
      const alpha = q.a + 0.06*Math.sin(q.t);
      bctx.globalAlpha = alpha;
      bctx.fillStyle = q.c;
      bctx.fillRect(q.x, q.y, q.s, q.s);
    }
    bctx.globalAlpha = 1;
    requestAnimationFrame(drawBG);
  }
  requestAnimationFrame(drawBG);

  /* ---------------- Game config ---------------- */
  const CELL = 30, COLS = 20, ROWS = 20;
  const TICK_MS = 95, QUOTE_MS = 3500, LIT_EVERY = 5;

  const quotes = [
    "Small steps spark big ideas.",
    "Your curiosity is your superpower.",
    "Progress over perfection.",
    "You light the way‚Äîkeep going.",
    "Create boldly. Iterate kindly.",
    "Every try teaches something.",
    "Energy flows where focus goes.",
    "You‚Äôve got this. One square at a time.",
    "Clarity follows motion.",
    "Tiny wins. Bright days."
  ];

  /* ---------------- Sound ---------------- */
  const AudioCtx = window.AudioContext || window.webkitAudioContext;
  let ac = null, soundOn = false;
  const soundBtn = document.getElementById('soundBtn');
  function ensureAC(){ if (!ac) ac = new AudioCtx(); }
  function beep(freq=440, dur=0.12, vol=0.06, type='sine'){
    if (!soundOn || !AudioCtx) return;
    ensureAC();
    const t = ac.currentTime;
    const o = ac.createOscillator(); const g = ac.createGain();
    o.type = type; o.frequency.setValueAtTime(freq, t);
    g.gain.setValueAtTime(vol, t);
    o.connect(g); g.connect(ac.destination);
    o.start(t); g.gain.exponentialRampToValueAtTime(0.0001, t + dur); o.stop(t + dur);
  }
  soundBtn.onclick = () => {
    soundOn = !soundOn;
    if (soundOn){ ensureAC(); beep(660,0.07,0.05); soundBtn.textContent = 'üîä Sound: On'; }
    else { soundBtn.textContent = 'üîà Sound: Off'; }
  };

  /* ---------------- State ---------------- */
  const canvas = document.getElementById('game');
  const c = canvas.getContext('2d');
  if (!c) return;

  const scoreEl = document.getElementById('score');
  const highEl  = document.getElementById('high');
  const moodEl  = document.getElementById('mood');
  const quoteEl = document.getElementById('quote');

  let snake, dir, nextDir, food, score, high, loop, mood, queuedGrowth;
  let shakeTime = 0, shakeMag = 0;
  let overlayAlpha = 0, lastTick = Date.now();
  const effects = [];
  let mode = 'start'; // 'start' | 'play' | 'gameover'

  high = Number(localStorage.getItem('44w_pos_snake_high') || 0);
  highEl.textContent = high;

  function baseReset(){
    snake = [{x: Math.floor(COLS/2), y: Math.floor(ROWS/2)}];
    dir = {x:1, y:0}; nextDir = {x:1, y:0};
    food = spawnFood();
    score = 0; mood = 'normal'; queuedGrowth = 2;
    shakeTime = 0; shakeMag = 0; overlayAlpha = 0; effects.length = 0;
    hideQuote();
    updateHUD(); render();
  }

  const randInt = n => Math.floor(Math.random()*n);
  function spawnFood(){
    let pos;
    do { pos = {x: randInt(COLS), y: randInt(ROWS)}; }
    while (snake.some(s => s.x===pos.x && s.y===pos.y));
    const nextIsLit = ((score+1) % LIT_EVERY === 0);
    return {...pos, lit: nextIsLit};
  }

  // Quote card controls
  function setQuote(text){
    quoteEl.textContent = text;
    quoteEl.classList.add('show');
    clearTimeout(setQuote._t);
    setQuote._t = setTimeout(()=>quoteEl.classList.remove('show'), QUOTE_MS);
  }
  function hideQuote(){
    quoteEl.classList.remove('show');
    clearTimeout(setQuote._t);
  }

  function updateHUD(){
    scoreEl.textContent = score; highEl.textContent = high;
    moodEl.textContent = (mood === 'extra') ? 'üòÑ' : 'üôÇ';
  }

  /* ---------------- Drawing ---------------- */
  function drawGrid(){
    c.save();
    c.strokeStyle = 'rgba(255,255,255,.08)'; c.lineWidth = 1;
    for (let x=0; x<=COLS; x++){ c.beginPath(); c.moveTo(x*CELL,0); c.lineTo(x*CELL,canvas.height); c.stroke(); }
    for (let y=0; y<=ROWS; y++){ c.beginPath(); c.moveTo(0,y*CELL); c.lineTo(canvas.width,y*CELL); c.stroke(); }
    c.restore();
  }
  function drawCell(x,y,color,radius=6){
    const px = x*CELL, py = y*CELL, w = CELL, h = CELL, r = radius;
    c.fillStyle = color; c.beginPath();
    c.moveTo(px+r, py);
    c.arcTo(px+w, py, px+w, py+h, r);
    c.arcTo(px+w, py+h, px, py+h, r);
    c.arcTo(px, py+h, px, py, r);
    c.arcTo(px, py, px+w, py, r);
    c.closePath(); c.fill();
  }
  function drawSnake(){
    const bodyColor = (mood==='extra') ? COLORS.snakeExtra : COLORS.snake;
    const headColor = (mood==='extra') ? COLORS.snakeExtra : COLORS.snakeHead;
    for (let i=1;i<snake.length;i++) drawCell(snake[i].x, snake[i].y, bodyColor, 6);
    const h = snake[0]; drawCell(h.x, h.y, headColor, 6);
    // tiny face
    c.fillStyle = COLORS.face;
    const cx = h.x*CELL + CELL/2, cy = h.y*CELL + CELL/2;
    const eyeR = 2.5, eyeDX = 6, eyeDY = -3;
    c.beginPath(); c.arc(cx-eyeDX, cy+eyeDY, eyeR, 0, Math.PI*2); c.fill();
    c.beginPath(); c.arc(cx+eyeDX, cy+eyeDY, eyeR, 0, Math.PI*2); c.fill();
    c.lineWidth = 2; c.beginPath();
    c.arc(cx, cy+4, (mood==='extra')?8:6, 0.2*Math.PI, 0.8*Math.PI, false); c.stroke();
  }
  function drawBulb(b){
    const px = b.x*CELL + CELL/2, py = b.y*CELL + CELL/2, r = CELL*0.28;
    if (b.lit){
      c.save(); c.shadowColor = COLORS.bulbOnGlow; c.shadowBlur = 16;
      c.beginPath(); c.arc(px, py, r, 0, Math.PI*2); c.fillStyle = COLORS.bulbOn; c.fill(); c.restore();
    } else {
      c.beginPath(); c.arc(px, py, r, 0, Math.PI*2); c.fillStyle = COLORS.bulbOff; c.fill();
      c.lineWidth = 2; c.strokeStyle = COLORS.bulbOffStroke; c.stroke();
    }
    c.fillStyle = '#7a8699'; c.fillRect(px - r*0.5, py + r*0.6, r, r*0.45);
    c.fillStyle = '#5b6575'; c.fillRect(px - r*0.5, py + r*0.6, r, 3);
  }
  function drawEffects(now){
    for (let i = effects.length - 1; i >= 0; i--){
      const e = effects[i], k = Math.min(1, (now - e.start)/e.dur);
      const px = e.x*CELL + CELL/2, py = e.y*CELL + CELL/2;
      const r = (CELL*0.28)*(1 + 0.9*k), alpha = 1 - k;
      c.save(); c.globalAlpha = alpha;
      if (e.lit){ c.shadowColor = COLORS.bulbOnGlow; c.shadowBlur = 14; c.fillStyle = COLORS.bulbOn; }
      else { c.fillStyle = COLORS.bulbOff; }
      c.beginPath(); c.arc(px, py, r, 0, Math.PI*2); c.fill();
      c.restore();
      if (k >= 1) effects.splice(i,1);
    }
  }

  function renderStartOverlay(){
    c.save();
    c.fillStyle = 'rgba(14,27,61,.86)';
    c.fillRect(0,0,canvas.width,canvas.height);
    c.fillStyle = '#ffffff';
    c.textAlign='center';
    c.font = '20px "Press Start 2P", monospace';
    c.fillText('Positivity Snake', canvas.width/2, canvas.height/2 - 160);

    c.font = '12px "Press Start 2P", monospace';
    const lines = [
      'You‚Äôre on a journey to a clear mind.',
      'Munch ideas as üí° bulbs to keep moving.',
      'Every 5th bulb glows bright‚Äîcatch it to unlock',
      'an inspiring thought and glow GREEN with momentum.',
      'Arrows/WASD to move ‚Ä¢ Don‚Äôt bonk walls or yourself',
      'Tap/Click the canvas or press Space/Enter to begin'
    ];
    let y = canvas.height/2 - 90;
    for (const L of lines){ c.fillText(L, canvas.width/2, y); y += 26; }

    c.font = '14px "Press Start 2P", monospace';
    c.fillText('Start', canvas.width/2, canvas.height/2 + 90);
    c.restore();
  }

  function renderGameOverOverlay(){
    if (overlayAlpha <= 0) return;
    c.save();
    c.globalAlpha = overlayAlpha;
    c.fillStyle = '#102a6b';
    c.fillRect(0,0,canvas.width,canvas.height);
    c.globalAlpha = 1;
    c.fillStyle = '#ffffff';
    c.textAlign='center';
    c.font = '20px "Press Start 2P", monospace';
    c.fillText('Game Over', canvas.width/2, canvas.height/2 - 8);
    c.font = '12px "Press Start 2P", monospace';
    c.fillText('Tap/Click or Space/Enter to play again', canvas.width/2, canvas.height/2 + 26);
    c.restore();
  }

  function render(){
    c.save();
    if (shakeTime > 0){ const dx = (Math.random()*2-1)*shakeMag, dy = (Math.random()*2-1)*shakeMag; c.translate(dx, dy); }
    c.clearRect(-50,-50,canvas.width+100,canvas.height+100);
    drawGrid(); drawBulb(food); drawSnake(); drawEffects(performance.now());
    c.restore();

    if (mode === 'start') renderStartOverlay();
    if (mode === 'gameover') renderGameOverOverlay();
  }

  /* ---------------- Loop ---------------- */
  function step(){
    const now = Date.now(), dt = now - lastTick; lastTick = now;
    if (shakeTime > 0){ shakeTime -= dt; if (shakeTime < 0) shakeTime = 0; shakeMag *= 0.9; }
    if (mode !== 'play') { render(); return; }

    dir = nextDir;
    const head = {x: snake[0].x + dir.x, y: snake[0].y + dir.y};
    if (head.x < 0 || head.x >= COLS || head.y < 0 || head.y >= ROWS){ wallImpact(); return gameOver(); }
    if (snake.some(s => s.x===head.x && s.y===head.y)) return gameOver();

    snake.unshift(head);
    if (queuedGrowth > 0) queuedGrowth--; else snake.pop();

    if (head.x===food.x && head.y===food.y){
      effects.push({x: food.x, y: food.y, lit: food.lit, start: performance.now(), dur: 240});
      if (food.lit){
        beep(1040,0.09,0.07);
        setQuote(quotes[randInt(quotes.length)]);
        mood = 'extra';
      } else {
        beep(660,0.07,0.05);
        if (mood==='extra') mood = 'normal';
      }
      score++; queuedGrowth += 1;
      if (score > high){ high = score; localStorage.setItem('44w_pos_snake_high', String(high)); }
      food = spawnFood(); updateHUD();
    }

    render();
  }

  function wallImpact(){ beep(220,0.14,0.08,'square'); shakeTime = 250; shakeMag = 6; }

  function gameOver(){
    clearInterval(loop); loop = null; mode = 'gameover';
    overlayAlpha = 0;
    const start = performance.now(), DUR = 650;
    function fade(t){ const k = Math.min(1,(t-start)/DUR); overlayAlpha = 0.75*k; render(); if (k<1) requestAnimationFrame(fade); }
    requestAnimationFrame(fade);
  }

  /* ---------------- Controls & Start/Restart ---------------- */
  function setDir(x,y){ if (snake.length>1 && x===-dir.x && y===-dir.y) return; nextDir = {x,y}; }
  addEventListener('keydown', (e)=>{
    const k = e.key.toLowerCase();
    if (k==='arrowup'||k==='w') setDir(0,-1);
    else if (k==='arrowdown'||k==='s') setDir(0,1);
    else if (k==='arrowleft'||k==='a') setDir(-1,0);
    else if (k==='arrowright'||k==='d') setDir(1,0);
    else if (k===' ' || k==='enter'){ if (mode !== 'play') start(); }
  });
  document.getElementById('up').onclick = ()=>{ if(mode!=='play') start(); setDir(0,-1); };
  document.getElementById('down').onclick = ()=>{ if(mode!=='play') start(); setDir(0,1); };
  document.getElementById('left').onclick = ()=>{ if(mode!=='play') start(); setDir(-1,0); };
  document.getElementById('right').onclick = ()=>{ if(mode!=='play') start(); setDir(1,0); };
  canvas.addEventListener('pointerdown', ()=>{ if (mode !== 'play') start(); }, {passive:true});

  function start(){
    baseReset(); lastTick = Date.now(); mode = 'play';
    clearInterval(loop); loop = setInterval(step, TICK_MS);
  }

  baseReset(); mode = 'start'; render();
})();
</script>
</body>
</html>
